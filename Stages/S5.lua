Set5={
	name = "Rink of Frozen Blood",
	nR = 5,
	rounds = {			
		--first round
		[1] = {
			nWave =4,
			Waves = {
				[1] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =163691,posy =50017,posz =102214,X=0.47781065106392,Y=0.53402364253998, texture = "MAHelper/Icons/Signal.dds",  c = 1,}, 
						[2] = {posx =164383,posy =50019,posz =101517,X=0.48816567659378,Y=0.52366864681244, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
					},
				},
				[2] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =166944,posy =50025,posz =100393,X=0.52662724256516,Y=0.50591713190079, texture = "MAHelper/Icons/Signal2.dds",   c = 1,}, 
						[2] = {posx =167167,posy =50018,posz =99354,X=0.52958577871323,Y=0.4911242723465, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
					},
				},
				[3] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =163505,posy =50014,posz =97906,X=0.47633135318756,Y=0.47041419148445, texture = "MAHelper/Icons/Signal3.dds",   c = 1,}, 
						[2] = {posx =164478,posy =50034,posz =97901,X=0.48964497447014,Y=0.47041419148445, texture = "MAHelper/Icons/Signal3.dds",  c = 1,},
					},
				},
				[4] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =167525,posy =50024,posz =100015,X=0.53550297021866,Y=0.50147926807404, texture = "MAHelper/Icons/BossRMael.dds",  c = 2,},
					},
				},
			},
		},
		--second round
		[2] = {
		
			nWave =3,
			Waves = {
				[1] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =163428,posy =50017,posz =100582,X=0.47485208511353,Y=0.5088757276535, texture = "MAHelper/Icons/Signal.dds",  c= 1}, 
						[2] = {posx =162591,posy =49999,posz =101567,X=0.46153846383095,Y=0.52366864681244, texture = "MAHelper/Icons/Signal.dds",  c= 1}, 
						[3] = {posx =163650,posy =50014,posz =102299,X=0.47781065106392,Y=0.53402364253998, texture = "MAHelper/Icons/Signal.dds",  c= 1}, 
					},
				},
				[2] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =166859,posy =50023,posz =100951,X=0.52514791488647,Y=0.51479291915894, texture = "MAHelper/Icons/Signal2.dds",  c= 1}, 
						[2] = {posx =166967,posy =50022,posz =99078,X=0.52662724256516,Y=0.48668637871742, texture = "MAHelper/Icons/Signal2.dds",  c= 1}, 
						[3] = {posx =167641,posy =50008,posz =99999,X=0.53698223829269,Y=0.5, texture = "MAHelper/Icons/Signal2.dds",  c= 1},
					},
				},
				[3] = {
					nMOB = 1,
					Mobs = {						
						[1] = {posx =163838,posy =50007,posz =97336,X=0.48076921701431,Y=0.46153846383095, texture = "MAHelper/Icons/BossRMael.dds",  c = 2,},
					},
				},
			},
		},	
		--third round
		[3] = {
		
			nWave =3,
			Waves = {
				[1] = {
					nMOB = 4,
					Mobs = {	
						[1] = {posx =162884,posy =50014,posz =101090,X=0.4659763276577,Y=0.51627218723297, texture = "MAHelper/Icons/Signal.dds",  c= 1}, 
						[2] = {posx =162591,posy =49999,posz =101567,X=0.46153846383095,Y=0.52366864681244, texture = "MAHelper/Icons/BossRMael.dds",  c= 1}, 
						[3] = {posx =163650,posy =50014,posz =102299,X=0.47781065106392,Y=0.53402364253998, texture = "MAHelper/Icons/Signal.dds",  c= 1}, 
						[4] = {posx =167485,posy =50020,posz =99939,X=0.53402364253998,Y=0.5, texture = "MAHelper/Icons/Signal.dds",  c= 1}, 
					},
				},
				[2] = {
					nMOB = 4,
					Mobs = {
						[1] = {posx =166870,posy =50019,posz =101030,X=0.52514791488647,Y=0.51627218723297, texture = "MAHelper/Icons/Signal2.dds", c = 1,}, 
						[2] = {posx =167619,posy =50012,posz =100096,X=0.53698223829269,Y=0.50147926807404, texture = "MAHelper/Icons/Signal2.dds", c = 1,}, 
						[3] = {posx =163311,posy =50032,posz =98348,X=0.47337278723717,Y=0.47633135318756, texture = "MAHelper/Icons/Signal2.dds", c = 1,},
						[4] = {posx =163311,posy =50032,posz =98348,X=0.47337278723717,Y=0.47633135318756, texture = "MAHelper/Icons/Signal2.dds", c = 1,},
					},
				},
				[3] = {
					nMOB = 4,
					Mobs = {
						[1] = {posx =164948,posy =50024,posz =97943,X=0.49704143404961,Y=0.47041419148445, texture = "MAHelper/Icons/Signal3.dds", c = 1,}, 
						[2] = {posx =163533,posy =50015,posz =97470,X=0.47633135318756,Y=0.46301776170731, texture = "MAHelper/Icons/Signal3.dds", c = 1,}, 
						[3] = {posx =163533,posy =50015,posz =97470,X=0.47633135318756,Y=0.46301776170731, texture = "MAHelper/Icons/Signal3.dds", c = 1,}, 
						[4] = {posx =163533,posy =50015,posz =97470,X=0.47633135318756,Y=0.46301776170731, texture = "MAHelper/Icons/Signal3.dds", c = 1,}, 
					},
				},
			},
		},
		[4] = {
			nWave = 3,
			Waves = {
				[1] = {
					nMOB = 4,
					Mobs = {
						[1] = {posx =163863,posy =50032,posz =97695,X=0.48076921701431,Y=0.4659763276577, texture = "MAHelper/Icons/BossRMael.dds", c = 2},
						[2] = {posx =164616,posy =50027,posz =97807,X=0.49260354042053,Y=0.46893492341042, texture = "MAHelper/Icons/Signal.dds", c = 1},
						[3] = {posx =167069,posy =50034,posz =99755,X=0.52810651063919,Y=0.49704143404961, texture = "MAHelper/Icons/Signal.dds", c = 1},
						[4] = {posx =167557,posy =50008,posz =99892,X=0.53550297021866,Y=0.49852070212364, texture = "MAHelper/Icons/BossRMael.dds",  c = 2},							
					},
				},
				[2] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =165250,posy =49973,posz =100459,X=0.50147926807404,Y=0.50739645957947, texture = "MAHelper/Icons/Signal.dds", c = 1},
						[2] = {posx =163917,posy =49968,posz =99981,X=0.48224851489067,Y=0.5, texture = "MAHelper/Icons/Signal.dds", c = 1},							
					},
				},
				[3] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =162449,posy =49975,posz =99733,X=0.46005916595459,Y=0.49704143404961, texture = "MAHelper/Icons/BossRMael.dds", c = 2},
						[2] = {posx =164610,posy =49967,posz =102200,X=0.49260354042053,Y=0.53402364253998, texture = "MAHelper/Icons/Signal.dds", c = 1},							
					},
				},
			},
		},
		[5] = {
			nWave = 1,
			Waves = {
				[1] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =164826,posy =49970,posz =100106,X=0.49556213617325,Y=0.50295859575272, texture = "MAHelper/Icons/BossMaelIce.dds", c = 3},						
					},
				},
			},
		},
	},	
}
CurrWeave = 1
NumK = 0
local CS = 1
token = true
function Set5.RegEventsLoader()
	MAHelper.ListAddPosition(1,1)
	EVENT_MANAGER:RegisterForEvent(Set5.name .. "EffectChange", EVENT_EFFECT_CHANGED, Set5.OnCheckingEffect)
	EVENT_MANAGER:RegisterForEvent(Set5.name .. "PlayerDeath", EVENT_UNIT_DEATH_STATE_CHANGED, Set5.OnPlayerDeath)
	EVENT_MANAGER:RegisterForEvent(Set5.name .."Announcement", EVENT_DISPLAY_ANNOUNCEMENT, Set5.OnTitleAnnounced)
	EVENT_MANAGER:RegisterForEvent(Set5.name .."kill", EVENT_COMBAT_EVENT, Set5.OnUnitKilled)
	EVENT_MANAGER:AddFilterForEvent(Set5.name .."kill", EVENT_COMBAT_EVENT, REGISTER_FILTER_COMBAT_RESULT, ACTION_RESULT_DIED_XP)
end
function Set5.RegUnloadEvents()
	EVENT_MANAGER:UnregisterForEvent(Set5.name .. "EffectChange", EVENT_EFFECT_CHANGED, Set5.OnCheckingEffect)
	EVENT_MANAGER:UnregisterForEvent(Set5.name .. "PlayerDeath", EVENT_COMBAT_EVENT, Set5.OnPlayerDeath)
	EVENT_MANAGER:UnregisterForEvent(Set5.name .."Announcement", EVENT_DISPLAY_ANNOUNCEMENT, Set5.OnTitleAnnounced)
	EVENT_MANAGER:UnregisterForEvent(Set5.name .."kill", EVENT_COMBAT_EVENT, Set5.OnUnitKilled)
end

function Set5.OnCheckingEffect( eventCode,  changeType,  effectSlot,  effectName,  unitTag,  beginTime,  endTime,  stackCount,  iconName,  buffType,  effectType,  abilityType,  statusEffectType,  unitName,  unitId,  abilityId,  sourceUnitType)
	if effectName == "Portal Spawn" and NumK == 0 and token then
		token = false 
		zo_callLater(function() token = true end, 5000)
	end
	if effectName == "Portal Spawn" and unitName == "Troll Breaker"  then
			MAHelper.SetText("Troll Breaker spawned! Kill it!")
			zo_callLater(function() MAHelper.StopText() end, 6000)
			do return end
	end 
	if effectName == "Portal Spawn" and NumK ~= 0 and token then
		if CS == 3 then
			token = false
			NumK = NumK - Set5.rounds[CS].Waves[CurrWeave].nMOB 
			CurrWeave = CurrWeave + 1
			MAHelper.RemoveIcons()
			MAHelper.ListAddPosition(CS , CurrWeave)
			zo_callLater(function() token = true end, 6000)
		end
	end
end

function  Set5.OnTitleAnnounced(eventcode, title)
	CS = MAHelper.OnTitleReturnRound(title)
	if CS >= 1 then
		NumK = 0
		CurrWeave = 1
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CS , 1)
	end
end

function  Set5.OnPlayerDeath( eventCode,  unitTag,  isDead)
	if isDead and unitTag == "player" then
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CS , 1)
	end
end	

function Set5.OnUnitKilled(eventCode,   result,  isError,  abilityName,  abilityGraphic,   abilityActionSlotType,  sourceName,   sourceType,   targetName,   targetType,  hitValue,   powerType,   damageType,  log,  sourceUnitId,  targetUnitId,  abilityId,  overflow)
	if targetName == "Deathless Wolf" or targetName == "Auroral Guardian" then
		do return end
	end
	if CS == 5 and targetName ~= "Matriarch Runa" then
		do return end
	end
	NumK = NumK + 1
	if NumK >= Set5.rounds[CS].Waves[CurrWeave].nMOB then
		NumK = 0
		if CS == 5 then
			if IsUnitInCombat("player") then
				do return end
			end		
			MAHelper.RemoveIcons()
			do return end
		end
		MAHelper.RemoveIcons()
		CurrWeave = CurrWeave +1
		if CurrWeave <= Set5.rounds[CS].nWave then
			MAHelper.ListAddPosition(CS, CurrWeave)		
		else
			CS = CS +1
			if CS <= Set5.nR then 			
				MAHelper.ListAddPosition(CS, 1)	
			end
		end
	end
end


function MAHelper.OnTitleAnnounced( eventCode,  title,  description)
	NumK  = 0
	CurrWeave = 1
	CS = MAHelper.OnTitleReturnRound(title)
	if CS >= 1 then
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CS , 1)
	end
end