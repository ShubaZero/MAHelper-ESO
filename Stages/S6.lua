Set6={
	name =  "Spiral Shadows",
	nR = 5,
	rounds = {			
		--first round
		[1] = {
			nWave =5,
			Waves = {
				[1] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =165021,posy =50000,posz =32402,X=0.50249999761581,Y=0.51499998569489, texture = "MAHelper/Icons/Signal.dds",  c = 1,}, 
						[2] = {posx =164853,posy =50000,posz =31764,X=0.49750000238419,Y=0.49750000238419, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
					},
				},
				[2] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =166288,posy =50015,posz =32360,X=0.53250002861023,Y=0.51249998807907, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
					},
				},
				[3] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =163335,posy =50007,posz =31392,X=0.46000000834465,Y=0.48750001192093, texture = "MAHelper/Icons/Signal3.dds",   c = 1,}, 
						[2] = {posx =163807,posy =50024,posz =33131,X=0.47249999642372,Y=0.53250002861023, texture = "MAHelper/Icons/Signal3.dds",  c = 1,},
					},
				},
				[4] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =166038,posy =49999,posz =30633,X=0.52749997377396,Y=0.46999999880791, texture = "MAHelper/Icons/Signal4.dds",  c = 1,},
					},
				},
				[5] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =164067,posy =49999,posz =30404,X=0.47749999165535,Y=0.46500000357628, texture = "MAHelper/Icons/Signal5.dds",  c = 1,},
						[2] = {posx =165526,posy =49999,posz =33745,X=0.51499998569489,Y=0.54750001430511, texture = "MAHelper/Icons/BossRMael.dds",  c = 2,},
					},
				},
			},
		},
		--second round
		[2] = {
			nWave =5,
			Waves = {
				[1] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =163480,posy =49999,posz =32599,X=0.46250000596046,Y=0.5174999833107, texture = "MAHelper/Icons/Signal.dds",  c = 1,}, 
						[2] = {posx =165563,posy =49999,posz =33616,X=0.51499998569489,Y=0.5450000166893, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[3] = {posx =166060,posy =49999,posz =30791,X=0.52749997377396,Y=0.47249999642372, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
					},
				},
				[2] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =163460,posy =49999,posz =31558,X=0.46250000596046,Y=0.49250000715256, texture = "MAHelper/Icons/Signal2.dds",   c = 1,}, 
						[2] = {posx =164852,posy =49999,posz =30193,X=0.49750000238419,Y=0.45750001072884, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
					},
				},
				[3] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =166829,posy =50053,posz =32341,X=0.54750001430511,Y=0.51249998807907, texture = "MAHelper/Icons/Signal3.dds",   c = 1,}, 
					},
				},
				[4] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =166463,posy =50026,posz =32829,X=0.53750002384186,Y=0.52499997615814, texture = "MAHelper/Icons/Signal4.dds",  c = 1,},
						[2] = {posx =163927,posy =50015,posz =33259,X=0.47499999403954,Y=0.53500002622604, texture = "MAHelper/Icons/Signal4.dds",  c = 1,},
					},
				},
				[5] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =164152,posy =49999,posz =30463,X=0.47999998927116,Y=0.46500000357628, texture = "MAHelper/Icons/Signal5.dds",  c = 1,},
					},
				},
			},
		},
		--third round
		[3] = {
			nWave =5,
			Waves = {
				[1] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =165348,posy =49999,posz =33703,X=0.50999999046326,Y=0.54750001430511, texture = "MAHelper/Icons/Signal.dds",  c = 1,}, 
						[2] = {posx =163430,posy =50001,posz =31422,X=0.46250000596046,Y=0.49000000953674, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
					},
				},
				[2] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =165863,posy =50000,posz =33412,X=0.52249997854233,Y=0.54000002145767, texture = "MAHelper/Icons/Signal2.dds",   c = 1,}, 
						[2] = {posx =164587,posy =50000,posz =30505,X=0.49000000953674,Y=0.46750000119209, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
						[3] = {posx =165844,posy =50000,posz =30551,X=0.52249997854233,Y=0.46750000119209, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
					},
				},
				[3] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =164847,posy =49999,posz =31254,X=0.49750000238419,Y=0.48500001430511, texture = "MAHelper/Icons/BossRMael.dds",   c = 2,}, 
					},
				},
				[4] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =166686,posy =50032,posz =32967,X=0.54250001907349,Y=0.52749997377396, texture = "MAHelper/Icons/Signal4.dds",  c = 1,},
						[2] = {posx =166823,posy =50044,posz =32200,X=0.54750001430511,Y=0.50999999046326, texture = "MAHelper/Icons/Signal4.dds",  c = 1,},
					},
				},
				[5] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =166647,posy =50009,posz =31240,X=0.54250001907349,Y=0.48500001430511, texture = "MAHelper/Icons/Signal5.dds",  c = 1,},
						[2] = {posx =163857,posy =50027,posz =33335,X=0.47249999642372,Y=0.53750002384186, texture = "MAHelper/Icons/BossRMael.dds",  c = 2,},
					},
				},
			},
		},
		[4] = {
			nWave =4,
			Waves = {
				[1] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =163971,posy =49999,posz =30593,X=0.47499999403954,Y=0.46750000119209, texture = "MAHelper/Icons/Signal.dds",  c = 1,}, 
						[2] = {posx =165888,posy =49999,posz =30689,X=0.52249997854233,Y=0.46999999880791, texture = "MAHelper/Icons/Signal.dds",  c = 1,}, 
						[3] = {posx =163486,posy =50004,posz =31662,X=0.46250000596046,Y=0.49500000476837, texture = "MAHelper/Icons/BossRMael.dds",  c = 2,},
					},
				},
				[2] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =164593,posy =49999,posz =32084,X=0.49000000953674,Y=0.50499999523163, texture = "MAHelper/Icons/Signal2.dds",   c = 1,}, 
					},
				},
				[3] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =166578,posy =50034,posz =32138,X=0.54000002145767,Y=0.50749999284744, texture = "MAHelper/Icons/Signal3.dds",   c = 1,}, 
						[2] = {posx =164522,posy =49999,posz =33488,X=0.49000000953674,Y=0.54000002145767, texture = "MAHelper/Icons/Signal3.dds",  c = 1,},
						[3] = {posx =163616,posy =49999,posz =32795,X=0.46750000119209,Y=0.52249997854233, texture = "MAHelper/Icons/Signal3.dds",  c = 1,},
					},
				},
				[4] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =165352,posy =49999,posz =33564,X=0.50999999046326,Y=0.54250001907349, texture = "MAHelper/Icons/Signal4.dds",  c = 1,},
						[2] = {posx =164730,posy =49999,posz =30471,X=0.49500000476837,Y=0.46500000357628, texture = "MAHelper/Icons/Signal4.dds",  c = 1,},
					},
				},
			},
		},
		[5] = {
			nWave = 1,
			Waves = {
				[1] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =165011,posy =49999,posz =31164,X=0.50249999761581,Y=0.48249998688698, texture = "MAHelper/Icons/BossMaelSpider.dds", c = 3},						
					},
				},
			},
		},
	},	
}

CurrWeave = 1
NumK = 0
CS = 1
token = true
function Set6.RegEventsLoader()
	MAHelper.ListAddPosition(1,1)
	EVENT_MANAGER:RegisterForEvent(Set6.name .. "EffectChange", EVENT_EFFECT_CHANGED, Set6.OnCheckingEffect)
	EVENT_MANAGER:RegisterForEvent(Set6.name .. "PlayerDeath", EVENT_UNIT_DEATH_STATE_CHANGED, Set6.OnPlayerDeath)
	EVENT_MANAGER:RegisterForEvent(Set6.name .."Announcement", EVENT_DISPLAY_ANNOUNCEMENT, Set6.OnTitleAnnounced)
	EVENT_MANAGER:RegisterForEvent(Set6.name .."kill", EVENT_COMBAT_EVENT, Set6.OnUnitKilled)
	EVENT_MANAGER:AddFilterForEvent(Set6.name .."kill", EVENT_COMBAT_EVENT, REGISTER_FILTER_COMBAT_RESULT, ACTION_RESULT_DIED_XP)
end
function Set6.RegUnloadEvents()
	EVENT_MANAGER:UnregisterForEvent(Set6.name .. "EffectChange", EVENT_EFFECT_CHANGED, Set6.OnCheckingEffect)
	EVENT_MANAGER:UnregisterForEvent(Set6.name .. "PlayerDeath", EVENT_COMBAT_EVENT, Set6.OnPlayerDeath)
	EVENT_MANAGER:UnregisterForEvent(Set6.name .."Announcement", EVENT_DISPLAY_ANNOUNCEMENT, Set6.OnTitleAnnounced)
	EVENT_MANAGER:UnregisterForEvent(Set6.name .."kill", EVENT_COMBAT_EVENT, Set6.OnUnitKilled)
end

function Set6.OnCheckingEffect( eventCode,  changeType,  effectSlot,  effectName,  unitTag,  beginTime,  endTime,  stackCount,  iconName,  buffType,  effectType,  abilityType,  statusEffectType,  unitName,  unitId,  abilityId,  sourceUnitType)
	if effectName == "Portal Spawn" and NumK == 0 and token then
		token = false 
		zo_callLater(function() token = true end, 5000)
	end
	if effectName == "Portal Spawn" and NumK > 0 and token then
		token = false
		NumK = NumK - Set6.rounds[CS].Waves[CurrWeave].nMOB 
		CurrWeave = CurrWeave + 1
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CS , CurrWeave)
		zo_callLater(function() token = true end, 5000)
	end
end

function  Set6.OnTitleAnnounced(eventcode, title)
	NumK  = 0
	CurrWeave = 1
	CS = MAHelper.OnTitleReturnRound(title)
	if CS >= 1 then
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CS , 1)
	end
end

function  Set6.OnPlayerDeath( eventCode,  unitTag,  isDead)
	if isDead and unitTag == "player" then
		CurrWeave = 1
		NumK = 0
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CS , 1)
	end
end	

function Set6.OnUnitKilled(eventCode,   result,  isError,  abilityName,  abilityGraphic,   abilityActionSlotType,  sourceName,   sourceType,   targetName,   targetType,  hitValue,   powerType,   damageType,  log,  sourceUnitId,  targetUnitId,  abilityId,  overflow)

	if CS == 5 and targetName ~= "Champion of Atrocity" then
		do return end
	end
	NumK = NumK + 1
	if NumK >= Set6.rounds[CS].Waves[CurrWeave].nMOB then
		token = false 
		zo_callLater(function() token = true end, 5000)
		MAHelper.RemoveIcons()
		CurrWeave = CurrWeave +1
		if CurrWeave <= Set6.rounds[CS].nWave then
			NumK = 0			
			MAHelper.ListAddPosition(CS, CurrWeave)		
		else
			CurrWeave = 1
			NumK=0
			CS = CS +1
			if CS <= Set6.nR then 			
				MAHelper.ListAddPosition(CS, 1)	
			end
		end
	end
end
