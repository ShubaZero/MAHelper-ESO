Set8={
	name  = "Igneous Cistern",
	nR = 5,
	rounds = {			
		--first round
		[1] = {
			nWave =4,
			Waves = {
				[1] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =86685,posy =50073,posz =174025,X=0.50684928894043,Y=0.46803653240204,X2=0.25037935376167,Y2=1.2913504838943, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[2] = {posx =87558,posy =50065,posz =175589,X=0.52739727497101,Y=0.50228309631348,X2=0.26251897215843,Y2=1.3141123056412, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[3] = {posx =87554,posy =50089,posz =174590,X=0.52739727497101,Y=0.50228309631348,X2=0.26555386185646,Y2=1.2959028482437, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
					},
				},
				[2] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =85038,posy =50095,posz =175050,X=0.47031962871552,Y=0.49086758494377,X2=0.24279211461544,Y2=1.3429439067841, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
						[2] = {posx =84862,posy =50072,posz =176828,X=0.46575343608856,Y=0.53196346759796,X2=0.22458270192146,Y2=1.3338391780853, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
						[3] = {posx =86080,posy =50062,posz =177641,X=0.49315068125725,Y=0.55022829771042,X2=0.22610014677048,Y2=1.3080425262451, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
					},
				},
				[3] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =84774,posy =50064,posz =174165,X=-0.55205810070038,Y=0.52058112621307,X2=0.22154779732227,Y2=1.2913504838943, texture = "MAHelper/Icons/Signal3.dds",   c = 1,},
					},
				},
				[4] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =86254,posy =50083,posz =174455,X=0.49771690368652,Y=0.47716894745827,X2=0.24279211461544,Y2=1.3004552125931, texture = "MAHelper/Icons/Signal4.dds",  c = 2,},
					},
				},
			},
		},
		--second round
		[2] = {
			nWave =3,
			Waves = {
				[1] = {
					nMOB = 4,
					Mobs = {
						[1] = {posx =88340,posy =50019,posz =174472,X=0.54566210508347,Y=0.47716894745827,X2=0.27617603540421,Y2=1.2974203824997, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[2] = {posx =87924,posy =50041,posz =172916,X=0.53652966022491,Y=0.44292238354683,X2=0.27010622620583,Y2=1.2746585607529, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[3] = {posx =86134,posy =50032,posz =172747,X=0.49543377757072,Y=0.43835616111755,X2=0.24279211461544,Y2=1.2716237306595, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[4] = {posx =87776,posy =50014,posz =178237,X=0.53196346759796,Y=0.56392693519592,X2=0.26707130670547,Y2=1.3535660505295, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
					},
				},
				[2] = {
					nMOB = 4,
					Mobs = {
						[1] = {posx =84755,posy =50059,posz =174220,X=0.46347030997276,Y=0.47260272502899,X2=0.23368740081787,Y2=1.3641881942749, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
						[2] = {posx =87247,posy =50075,posz =173796,X=0.52054792642593,Y=0.46118721365929,X2=0.23368740081787,Y2=1.3641881942749, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
						[3] = {posx =85527,posy =50045,posz =178895,X=0.48173516988754,Y=0.57762557268143,X2=0.20789074897766,Y2=1.3596358299255, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
						[4] = {posx =83810,posy =49996,posz =178607,X=0.44292238354683,Y=0.57305938005447,X2=0.25796660780907,Y2=1.288315653801, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
					},
				},
				[3] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =87059,posy =50081,posz =175525,X=0.51598173379898,Y=0.50228309631348,X2=0.22761760652065,Y2=1.3065249919891, texture = "MAHelper/Icons/Signal3.dds",  c = 1,},
						[2] = {posx =86320,posy =50098,posz =175189,X=0.5,Y=0.49315068125725,X2=0.24582700431347,Y2=1.3080425262451, texture = "MAHelper/Icons/Signal3.dds",  c = 2,},
						[3] = {posx =85124,posy =50090,posz =175142,X=0.47260272502899,Y=0.49315068125725,X2=0.25493171811104,Y2=1.3141123056412, texture = "MAHelper/Icons/Signal3.dds",  c = 1,},
					},
				},
			},
		},
		--third round
		[3] = {
			nWave =3,
			Waves = {
				[1] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =87060,posy =50089,posz =173955,X=0.51598173379898,Y=0.46575343608856,X2=0.23520486056805,Y2=1.288315653801, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[2] = {posx =85659,posy =50056,posz =173874,X=0.48401826620102,Y=0.46347030997276,X2=0.25644916296005,Y2=1.2898330688477, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[3] = {posx =87867,posy =50070,posz =175006,X=0.53424656391144,Y=0.49086758494377,X2=0.26858878135681,Y2=1.3050075769424, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
					},
				},
				[2] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =85886,posy =50087,posz =177173,X=0.48858448863029,Y=0.53881275653839,X2=0.23975721001625,Y2=1.3383915424347, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
						[2] = {posx =86330,posy =50098,posz =177261,X=0.5,Y=0.54109591245651,X2=0.24430955946445,Y2=1.3383915424347, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
						[3] = {posx =85831,posy =50083,posz =178154,X=0.48858448863029,Y=0.56164383888245,X2=0.23823975026608,Y2=1.3535660505295, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
					},
				},
				[3] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =83571,posy =49986,posz =175111,X=0.43607306480408,Y=0.49315068125725,X2=0.2033383846283,Y2=1.3065249919891, texture = "MAHelper/Icons/Signal3.dds",  c = 1,},
						[2] = {posx =86149,posy =50075,posz =175811,X=0.49543377757072,Y=0.50913244485855,X2=0.24279211461544,Y2=1.3201820850372, texture = "MAHelper/Icons/Signal3.dds",  c = 2,},
						[3] = {posx =88550,posy =50026,posz =177195,X=0.55022829771042,Y=0.53881275653839,X2=0.27921092510223,Y2=1.3383915424347, texture = "MAHelper/Icons/Signal3.dds",  c = 1,},
					},
				},
			},
		},
		[4] = {
			nWave =3,
			Waves = {
				[1] = {
					nMOB = 5,
					Mobs = {
						[1] = {posx =87161,posy =50084,posz =174238,X=0.51826483011246,Y=0.47260272502899,X2=0.23520486056805,Y2=1.288315653801, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[2] = {posx =87630,posy =50076,posz =175917,X=0.52968037128448,Y=0.51141554117203,X2=0.27921092510223,Y2=1.3050075769424, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[3] = {posx =88630,posy =50028,posz =174994,X=0.5525113940239,Y=0.48858448863029,X2=0.25493171811104,Y2=1.2898330688477, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[4] = {posx =84542,posy =50094,posz =174815,X=0.45890411734581,Y=0.4863013625145,X2=0.23368740081787,Y2=1.2701061964035, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
						[5] = {posx =85639,posy =49986,posz =172690,X=0.48401826620102,Y=0.43607306480408,X2=0.21851289272308,Y2=1.3050075769424, texture = "MAHelper/Icons/Signal.dds",  c = 1,},
					},
				},
				[2] = {
					nMOB = 2,
					Mobs = {
						[1] = {posx =85854,posy =50083,posz =174462,X=0.48858448863029,Y=0.47716894745827,X2=0.26100152730942,Y2=1.3050075769424, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
						[2] = {posx =87287,posy =50096,posz =174930,X=0.52054792642593,Y=0.48858448863029,X2=0.23823975026608,Y2=1.294385433197, texture = "MAHelper/Icons/Signal2.dds",   c = 1,},
					},
				},
				[3] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx =84764,posy =50062,posz =173784,X=0.46347030997276,Y=0.46118721365929,X2=0.22154779732227,Y2=1.286798119545, texture = "MAHelper/Icons/Signal3.dds",  c = 1,},
						[2] = {posx =86235,posy =50097,posz =174836,X=0.49771690368652,Y=0.4863013625145,X2=0.24430955946445,Y2=1.3034901618958, texture = "MAHelper/Icons/Signal3.dds",  c = 2,},
						[3] = {posx =88393,posy =50054,posz =175536,X=0.54566210508347,Y=0.50228309631348,X2=0.27465856075287,Y2=1.3141123056412, texture = "MAHelper/Icons/Signal3.dds",  c = 1,},
					},
				},
			},
		},
		[5] = {
			nWave = 1,
			Waves = {
				[1] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx =86531,posy =50075,posz =174576,X=0.50456619262695,Y=0.47945204377174,X2=0.24886190891266,Y2=1.2989377975464, texture = "MAHelper/Icons/BossMaelCharmander.dds", c = 3},
					},
				},
			},
		},
	},	
}

CurrWeave = 1
NumK = 0
CS = 1
token = true
function Set8.RegEventsLoader()
	token = false 
	NumK = 0
	CS = 1
	MAHelper.ListAddPosition(1,1)
	EVENT_MANAGER:RegisterForEvent(Set8.name .. "EffectChange", EVENT_EFFECT_CHANGED, Set8.OnCheckingEffect)
	EVENT_MANAGER:RegisterForEvent(Set8.name .. "PlayerDeath", EVENT_UNIT_DEATH_STATE_CHANGED, Set8.OnPlayerDeath)
	EVENT_MANAGER:RegisterForEvent(Set8.name .."Announcement", EVENT_DISPLAY_ANNOUNCEMENT, Set8.OnTitleAnnounced)
	EVENT_MANAGER:RegisterForEvent(Set8.name .."kill", EVENT_COMBAT_EVENT, Set8.OnUnitKilled)
	EVENT_MANAGER:AddFilterForEvent(Set8.name .."kill", EVENT_COMBAT_EVENT, REGISTER_FILTER_COMBAT_RESULT, ACTION_RESULT_DIED_XP)
	zo_callLater(function() token = true end, 6000)
	
end
function Set8.RegUnloadEvents()
	CS = 1
	EVENT_MANAGER:UnregisterForEvent(Set8.name .. "EffectChange", EVENT_EFFECT_CHANGED, Set8.OnCheckingEffect)
	EVENT_MANAGER:UnregisterForEvent(Set8.name .. "PlayerDeath", EVENT_COMBAT_EVENT, Set8.OnPlayerDeath)
	EVENT_MANAGER:UnregisterForEvent(Set8.name .."Announcement", EVENT_DISPLAY_ANNOUNCEMENT, Set8.OnTitleAnnounced)
	EVENT_MANAGER:UnregisterForEvent(Set8.name .."kill", EVENT_COMBAT_EVENT, Set8.OnUnitKilled)
end

function Set8.OnCheckingEffect( eventCode,  changeType,  effectSlot,  effectName,  unitTag,  beginTime,  endTime,  stackCount,  iconName,  buffType,  effectType,  abilityType,  statusEffectType,  unitName,  unitId,  abilityId,  sourceUnitType)
	if effectName == "Portal Spawn" and NumK ~= 0 and token then
		token = false
		NumK = NumK - Set8.rounds[CS].Waves[CurrWeave].nMOB 
		CurrWeave = CurrWeave + 1
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CS , CurrWeave)
		zo_callLater(function() token = true end, 5000)
	end
end

function  Set8.OnTitleAnnounced(eventcode, title)
	NumK = 0 
	CurrWeave = 1
	CS = MAHelper.OnTitleReturnRound(title)
	if CS >= 1 then
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CS , 1)
	end
end

function  Set8.OnPlayerDeath( eventCode,  unitTag,  isDead)
	if isDead and unitTag == "player" then
		CurrWeave = 1
		NumK = 0
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CS , 1)
	end
end	

function Set8.OnUnitKilled(eventCode,   result,  isError,  abilityName,  abilityGraphic,   abilityActionSlotType,  sourceName,   sourceType,   targetName,   targetType,  hitValue,   powerType,   damageType,  log,  sourceUnitId,  targetUnitId,  abilityId,  overflow)
	NumK = NumK + 1
	if NumK >= Set8.rounds[CS].Waves[CurrWeave].nMOB then
		token = false 
		zo_callLater(function() token = true end, 4000)
		MAHelper.RemoveIcons()
		CurrWeave = CurrWeave +1
		NumK = 0
		if CurrWeave <= Set8.rounds[CS].nWave then
			MAHelper.ListAddPosition(CS, CurrWeave)		
		else
			CurrWeave = 1
			CS = CS +1
			if CS <= Set8.nR then 			
				MAHelper.ListAddPosition(CS, 1)	
			end
		end
	end
end
